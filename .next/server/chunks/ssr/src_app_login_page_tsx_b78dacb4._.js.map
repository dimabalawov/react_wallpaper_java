{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///Users/dimabalawov/wallpaper_imp/src/app/login/page.tsx"],"sourcesContent":["\"use client\";\nimport React, { useState } from \"react\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/navigation\";\nimport { useAuth } from \"@/context/AuthContext\";\nimport toast from \"react-hot-toast\";\n\nexport default function LoginPage() {\n  const [loginInput, setLoginInput] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const router = useRouter();\n  const { login } = useAuth();\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    try {\n      // 1. Login to get the session token (UUID)\n      // The backend expects 'usernameOrEmail' and 'password'\n      const loginResponse = await fetch(\"http://localhost:8080/users/login\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          usernameOrEmail: loginInput,\n          password,\n        }),\n      });\n\n      if (!loginResponse.ok) {\n        const errorText = await loginResponse.text();\n        let errorMessage: string;\n        try {\n          const errorData = JSON.parse(errorText);\n          errorMessage =\n            errorData.message || errorData.error || JSON.stringify(errorData);\n        } catch (e: unknown) {\n          // Use unknown instead of default (implicitly any) or simple catch\n          console.error(\"Failed to parse error response:\", e);\n          errorMessage = errorText;\n        }\n        throw new Error(\n          errorMessage || `Server error: ${loginResponse.status}`\n        );\n      }\n\n      // Robust token extraction\n      const responseText = await loginResponse.text();\n      console.log(\"Raw login response:\", responseText);\n\n      let token = \"\";\n      try {\n        // Try to parse as JSON first (e.g. \"uuid-string\" or {\"token\": \"...\"})\n        const data = JSON.parse(responseText);\n\n        if (typeof data === \"string\") {\n          token = data;\n        } else if (typeof data === \"object\" && data !== null) {\n          token =\n            (data as { token?: string }).token ||\n            (data as { accessToken?: string }).accessToken ||\n            (data as { jwt?: string }).jwt ||\n            \"\";\n        }\n      } catch (e: unknown) {\n        // Use unknown\n        console.error(\"Token parsing error:\", e);\n        // If parsing fails, assume the response body is the token itself (raw string)\n        token = responseText;\n      }\n\n      if (!token) {\n        throw new Error(\"Could not extract token from login response\");\n      }\n\n      // 2. Fetch user profile using the token\n      // We try with 'Bearer' prefix first (Standard JWT)\n      let profileResponse = await fetch(\"http://localhost:8080/users/profile\", {\n        method: \"GET\",\n        headers: {\n          Authorization: `Bearer ${token}`,\n        },\n      });\n\n      // Fallback: If Bearer fails (401/403), try sending just the token\n      // (in case the backend expects raw UUID/Token without 'Bearer' prefix)\n      if (profileResponse.status === 401 || profileResponse.status === 403) {\n        console.warn(\"Bearer auth failed, retrying with raw token...\");\n        profileResponse = await fetch(\"http://localhost:8080/users/profile\", {\n          method: \"GET\",\n          headers: {\n            Authorization: token,\n          },\n        });\n      }\n\n      if (!profileResponse.ok) {\n        const errorText = await profileResponse.text();\n        console.error(\n          \"Profile fetch failed:\",\n          profileResponse.status,\n          errorText\n        );\n        throw new Error(\"Failed to fetch profile\");\n      }\n\n      const userData = await profileResponse.json();\n\n      login(token, {\n        id: userData.id,\n        username: userData.username,\n        email: userData.email,\n      });\n\n      toast.success(\"Успішний вхід!\");\n      router.push(\"/\");\n    } catch (error: unknown) {\n      console.error(\"Login error:\", error);\n      // Show the actual error message from the server\n      const message =\n        error instanceof Error ? error.message : \"Невірний email або пароль\";\n      toast.error(message);\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col items-center justify-center px-4 py-16 sm:px-8 min-h-screen bg-gray-50\">\n      <div className=\"w-full max-w-md bg-white rounded-2xl px-6 py-8 shadow-sm border border-gray-100\">\n        <h1 className=\"text-3xl font-bold text-navy mb-8 text-center\">Вхід</h1>\n        <form onSubmit={handleSubmit} className=\"flex flex-col gap-6\">\n          <div>\n            <label htmlFor=\"email\" className=\"block text-navy font-medium mb-2\">\n              Email або Ім&apos;я користувача\n            </label>\n            <input\n              type=\"text\"\n              id=\"email\"\n              value={loginInput}\n              onChange={(e) => setLoginInput(e.target.value)}\n              className=\"w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-teal/20 focus:border-teal transition-all text-black\"\n              placeholder=\"example@mail.com або username\"\n              required\n            />\n          </div>\n          <div>\n            <label\n              htmlFor=\"password\"\n              className=\"block text-navy font-medium mb-2\"\n            >\n              Пароль\n            </label>\n            <input\n              type=\"password\"\n              id=\"password\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n              className=\"w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-teal/20 focus:border-teal transition-all text-black\"\n              placeholder=\"********\"\n              required\n            />\n          </div>\n          <button\n            type=\"submit\"\n            className=\"w-full bg-teal text-white font-bold rounded-xl py-4 text-lg hover:bg-navy transition-all shadow-lg shadow-teal/20 hover:shadow-navy/20 mt-4\"\n          >\n            УВІЙТИ\n          </button>\n        </form>\n        <div className=\"mt-6 text-center text-navy\">\n          Ще не маєте акаунту?{\" \"}\n          <Link\n            href=\"/register\"\n            className=\"text-teal font-semibold hover:underline\"\n          >\n            Зареєструватися\n          </Link>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}