{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/dimabalawov/wallpaper_imp/src/app/user/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useState } from \"react\";\nimport { useAuth } from \"@/context/AuthContext\";\nimport { useRouter } from \"next/navigation\";\nimport Link from \"next/link\";\nimport { Order, OrderDTO } from \"@/interfaces/order\";\n\nconst UserPage = () => {\n  const { user, isAuthenticated, logout } = useAuth();\n  const router = useRouter();\n  const [orders, setOrders] = useState<Order[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    if (!isAuthenticated) {\n      router.push(\"/login\");\n      return;\n    }\n\n    const fetchOrders = async () => {\n      try {\n        const token = localStorage.getItem(\"token\");\n        const res = await fetch(\"http://localhost:8080/orders/my-history\", {\n          headers: {\n            Authorization: `Bearer ${token}`,\n          },\n        });\n\n        if (res.ok) {\n          const rawData: OrderDTO[] = await res.json();\n\n          const formattedOrders = rawData.map((order) => {\n            const items = order.items.map((item) => {\n              // Convert types safely if they come as strings from API\n              const price = Number(item.purchasePrice) || 0;\n              const qty = Number(item.quantity) || 1;\n              const totalPrice = Number(item.totalPrice) || price * qty;\n\n              return {\n                ...item,\n                // Using 'name' directly from your OrderItemHistoryResponse record\n                productName: item.name || \"Товар\",\n                price: price,\n                quantity: qty,\n                totalPrice: totalPrice,\n              };\n            });\n\n            const calculatedTotal = items.reduce(\n              (acc, item) => acc + item.totalPrice,\n              0\n            );\n\n            return {\n              id: order.id,\n              orderDate: order.createdAt || new Date().toISOString(),\n              totalAmount: calculatedTotal,\n              items: items,\n            };\n          });\n\n          // Sort newest first\n          formattedOrders.sort(\n            (a, b) =>\n              new Date(b.orderDate).getTime() - new Date(a.orderDate).getTime()\n          );\n\n          setOrders(formattedOrders);\n        }\n      } catch (error) {\n        console.error(\"Error fetching orders:\", error);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchOrders();\n  }, [isAuthenticated, router]);\n\n  if (!user) return null;\n\n  return (\n    <div className=\"flex flex-col px-4 sm:px-8 md:px-[clamp(2rem,6vw,8rem)] py-12 bg-gray-50 min-h-screen\">\n      <div className=\"max-w-7xl mx-auto w-full\">\n        <div className=\"flex flex-col lg:flex-row gap-8 xl:gap-12\">\n          {/* Sidebar */}\n          <div className=\"w-full lg:w-1/3 xl:w-1/4\">\n            <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 sticky top-24\">\n              <div className=\"flex flex-col items-center mb-6\">\n                <div className=\"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4 text-3xl font-bold text-navy\">\n                  {user.username.charAt(0).toUpperCase()}\n                </div>\n                <h2 className=\"text-xl font-bold text-navy\">{user.username}</h2>\n                <p className=\"text-gray-500\">{user.email}</p>\n              </div>\n              <div className=\"border-t border-gray-100 mt-6 pt-6\">\n                <button\n                  onClick={logout}\n                  className=\"w-full bg-gray-50 text-navy font-bold rounded-xl py-3 hover:bg-gray-100 transition-colors border border-gray-200\"\n                >\n                  Вийти\n                </button>\n              </div>\n            </div>\n          </div>\n\n          {/* Order History */}\n          <div className=\"flex-1\">\n            <h1 className=\"text-3xl font-bold text-navy mb-8\">\n              Історія замовлень\n            </h1>\n\n            {loading ? (\n              <div className=\"flex justify-center py-12\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-teal\"></div>\n              </div>\n            ) : orders.length === 0 ? (\n              <div className=\"bg-white rounded-2xl p-12 text-center border border-gray-100 shadow-sm\">\n                <div className=\"text-gray-400 text-xl mb-6\">\n                  У вас ще немає замовлень\n                </div>\n                <Link\n                  href=\"/printings\"\n                  className=\"inline-block bg-teal text-white font-bold rounded-xl px-8 py-3 hover:bg-navy\"\n                >\n                  До каталогу\n                </Link>\n              </div>\n            ) : (\n              <div className=\"space-y-6\">\n                {orders.map((order) => (\n                  <div\n                    key={order.id}\n                    className=\"bg-white rounded-2xl p-6 shadow-sm border border-gray-100\"\n                  >\n                    <div className=\"flex justify-between items-start mb-6 border-b border-gray-50 pb-4\">\n                      <div>\n                        <div className=\"text-sm text-gray-500 mb-1\">\n                          Замовлення №\n                        </div>\n                        <div className=\"text-lg font-bold text-navy\">\n                          #{order.id.slice(0, 8)}\n                        </div>\n                      </div>\n                      <div className=\"text-sm text-gray-500\">\n                        {new Date(order.orderDate).toLocaleString(\"uk-UA\")}\n                      </div>\n                    </div>\n\n                    <div className=\"space-y-4 mb-6\">\n                      {order.items.map((item, idx) => (\n                        <div\n                          key={idx}\n                          className=\"flex justify-between items-center\"\n                        >\n                          <div>\n                            {/* Displaying the name from the Record */}\n                            <h4 className=\"font-bold text-navy\">\n                              {item.productName}\n                            </h4>\n                            <div className=\"text-sm text-gray-500\">\n                              {item.quantity} шт x {item.price} грн\n                            </div>\n                          </div>\n                          <div className=\"font-bold text-navy\">\n                            {item.totalPrice} грн\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n\n                    <div className=\"flex justify-end pt-4 border-t border-gray-100\">\n                      <div className=\"text-xl font-bold text-teal\">\n                        {order.totalAmount} грн\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default UserPage;\n"],"names":[],"mappings":"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","debugId":null}}]
}