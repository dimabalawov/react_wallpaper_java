(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[584],{4202:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var s=r(5155),a=r(2115),l=r(9576),o=r(5695),i=r(6874),c=r.n(i);let n=()=>{let{user:e,isAuthenticated:t,logout:r}=(0,l.A)(),i=(0,o.useRouter)(),[n,d]=(0,a.useState)([]),[m,x]=(0,a.useState)(!0);return((0,a.useEffect)(()=>{if(!t)return void i.push("/login");(async()=>{try{let e=localStorage.getItem("token"),t=await fetch("http://localhost:8080/orders/my-history",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();console.log("Raw Orders Data:",JSON.stringify(e,null,2));let r=await Promise.all(e.map(async e=>{let t=await Promise.all(e.items.map(async e=>{let t="Товар",r="";try{if(e.productId){let s="WALLPAPER"===e.productType?"http://localhost:8080/wallpapers/".concat(e.productId):"http://localhost:8080/souvenirs/".concat(e.productId),a=await fetch(s);if(a.ok){let e=await a.json();t=e.name,r=e.image}else console.warn("Failed to fetch product details for ".concat(e.productId,": ").concat(a.status))}}catch(e){console.error("Error fetching product details",e)}let s="number"==typeof e.purchasePrice?e.purchasePrice:Number(e.purchasePrice),a="number"==typeof e.quantity?e.quantity:Number(e.quantity),l=isNaN(s)?0:s,o=isNaN(a)?1:a;return{...e,productName:t,imageUrl:r,price:l,quantity:o,totalPrice:l*o}})),r="number"==typeof e.totalPrice?e.totalPrice:Number(e.totalPrice);return{id:e.id,orderDate:e.createdAt||new Date().toISOString(),totalAmount:isNaN(r)?0:r,items:t}}));r.sort((e,t)=>new Date(t.orderDate).getTime()-new Date(e.orderDate).getTime()),d(r)}else console.error("Failed to fetch orders")}catch(e){console.error("Error fetching orders:",e)}finally{x(!1)}})()},[t,i]),e)?(0,s.jsx)("div",{className:"flex flex-col px-4 sm:px-8 md:px-[clamp(2rem,6vw,8rem)] py-12 bg-gray-50 min-h-screen",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto w-full",children:(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row gap-8 xl:gap-12",children:[(0,s.jsx)("div",{className:"w-full lg:w-1/3 xl:w-1/4",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 sticky top-24",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center mb-6",children:[(0,s.jsx)("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4 text-3xl font-bold text-navy",children:e.username.charAt(0).toUpperCase()}),(0,s.jsx)("h2",{className:"text-xl font-bold text-navy",children:e.username}),(0,s.jsx)("p",{className:"text-gray-500",children:e.email})]}),(0,s.jsxs)("div",{className:"border-t border-gray-100 pt-6",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider mb-4",children:"Мій Профіль"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"ID користувача:"}),(0,s.jsx)("span",{className:"font-medium text-navy",children:e.id})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"Email:"}),(0,s.jsx)("span",{className:"font-medium text-navy",children:e.email})]})]})]}),(0,s.jsx)("div",{className:"border-t border-gray-100 mt-6 pt-6",children:(0,s.jsx)("button",{onClick:r,className:"w-full bg-gray-50 text-navy font-bold rounded-xl py-3 hover:bg-gray-100 transition-colors border border-gray-200",children:"Вийти"})})]})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-navy mb-8",children:"Історія замовлень"}),m?(0,s.jsx)("div",{className:"flex justify-center py-12",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-teal"})}):0===n.length?(0,s.jsxs)("div",{className:"bg-white rounded-2xl p-12 text-center border border-gray-100 shadow-sm",children:[(0,s.jsx)("div",{className:"text-gray-400 text-xl mb-6",children:"У вас ще немає замовлень"}),(0,s.jsx)(c(),{href:"/wallpapers",className:"inline-block bg-teal text-white font-bold rounded-xl px-8 py-3 hover:bg-navy transition-colors",children:"Перейти до каталогу"})]}):(0,s.jsx)("div",{className:"space-y-6",children:n.map(e=>(0,s.jsxs)("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 transition-shadow hover:shadow-md",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 border-b border-gray-50 pb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-gray-500 mb-1",children:"Замовлення №"}),(0,s.jsxs)("div",{className:"text-lg font-bold text-navy",children:["#",e.id.slice(0,8)]})]}),(0,s.jsx)("div",{className:"flex flex-col sm:items-end mt-2 sm:mt-0",children:(0,s.jsx)("div",{className:"text-sm text-gray-500 mb-1",children:new Date(e.orderDate).toLocaleString("uk-UA",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"})})})]}),(0,s.jsx)("div",{className:"space-y-4 mb-6",children:e.items.map((e,t)=>(0,s.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h4",{className:"font-medium text-navy line-clamp-2",children:e.productName}),(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:[e.quantity," шт x ",e.price," грн"]})]}),(0,s.jsxs)("div",{className:"font-bold text-navy",children:[e.totalPrice," грн"]})]},t))}),(0,s.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t border-gray-100",children:[(0,s.jsx)("div",{className:"text-gray-500 text-sm"}),(0,s.jsxs)("div",{className:"text-xl font-bold text-teal",children:[e.totalAmount," грн"]})]})]},e.id))})]})]})})}):null}},5695:(e,t,r)=>{"use strict";var s=r(8999);r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})},8361:(e,t,r)=>{Promise.resolve().then(r.bind(r,4202))},9576:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,AuthProvider:()=>i});var s=r(5155),a=r(2115),l=r(5695);let o=(0,a.createContext)(void 0),i=e=>{let{children:t}=e,[r,i]=(0,a.useState)(null),c=(0,l.useRouter)();(0,a.useEffect)(()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("user");if(e&&t)try{i(JSON.parse(t))}catch(e){console.error("Failed to parse user data",e),localStorage.removeItem("token"),localStorage.removeItem("user")}},[]);let n=async()=>{let e=localStorage.getItem("token");if(e)try{await fetch("http://localhost:8080/users/logout",{method:"GET",headers:{Authorization:"Bearer ".concat(e)}})}catch(e){console.error("Logout failed on server",e)}localStorage.removeItem("token"),localStorage.removeItem("user"),i(null),c.push("/login")};return(0,s.jsx)(o.Provider,{value:{user:r,login:(e,t)=>{localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(t)),i(t)},logout:n,isAuthenticated:!!r},children:t})},c=()=>{let e=(0,a.useContext)(o);if(void 0===e)throw Error("useAuth must be used within a AuthProvider");return e}}},e=>{e.O(0,[874,441,964,358],()=>e(e.s=8361)),_N_E=e.O()}]);